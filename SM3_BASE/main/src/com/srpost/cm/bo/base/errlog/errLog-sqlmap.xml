<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="_errLog">

    <sql id="dynamicWhere">
        <if test="@Ognl@isNotEmpty(solvYn)">
            AND SOLV_YN  = #{solvYn}
        </if>
        <if test="@Ognl@isNotEmpty(searchVal)">
            <if test="searchKey == 1000">
                AND URL LIKE '%' || #{searchVal} || '%'
            </if>
            <if test="searchKey == 1001">
                AND TITLE LIKE '%' || #{searchVal} || '%'
            </if>
            <if test="searchKey == 1002">
                AND CONTENTS LIKE '%' || #{searchVal} || '%'
            </if>
        </if>
        <if test="@Ognl@isNotEmpty(startDt)">
            AND REG_DT &gt;= TO_DATE(#{startDt}, 'YYYYMMDDHH24MISS')
        </if>
        <if test="@Ognl@isNotEmpty(endDt)">
            AND REG_DT &lt;= TO_DATE(#{endDt}, 'YYYYMMDDHH24MISS')
        </if>
    </sql>
    
    <sql id="dynamicSort">
        <if test="@Ognl@isNotEmpty(sortName)">
            ORDER BY
            <if test="sortName == 'regDt'">REG_DT</if>
            <if test="sortName == 'solvDt'">SOLV_DT</if>
            ${sortOrder}
        </if>
    </sql>

    <select id="list" resultType="errLogBean" parameterType="map">
        SELECT Y.* FROM (
            SELECT ROWNUM NUM, X.* FROM (       
                SELECT /*+ INDEX_DESC(CO_ERR_LOG) */
                       SEQ     AS seq,
                       URL     AS url,
                       TITLE   AS title,
                       SOLV_YN AS solvYn,
                       TO_CHAR(SOLV_DT, 'YYYY-MM-DD') AS solvDt,
                       TO_CHAR(REG_DT, 'YYYY-MM-DD') AS regDt
                  FROM CO_ERR_LOG
                 WHERE 1 = 1
                       <include refid="dynamicWhere" />
                       <include refid="dynamicSort" />
                ) X
            WHERE ROWNUM &lt;= #{pagingEndNum}
         ) Y
         WHERE NUM &gt;= #{pagingStartNum}
    </select>
    
    <select id="listCount" resultType="int" parameterType="map">
        SELECT COUNT(SEQ) AS totalCount
          FROM CO_ERR_LOG
         WHERE 1 = 1
               <include refid="dynamicWhere" />
    </select>
    
    <select id="listExcel" resultType="errLogBean" parameterType="map">
        SELECT /*+ INDEX_DESC(CO_ERR_LOG) */
               SEQ     AS seq,
               URL     AS url,
               TITLE   AS title,
               SOLV_YN AS solvYn,
               TO_CHAR(SOLV_DT, 'YYYY-MM-DD') AS solvDt,
               TO_CHAR(REG_DT, 'YYYY-MM-DD') AS regDt
          FROM CO_ERR_LOG
         WHERE 1 = 1
               <include refid="dynamicWhere" />
               <include refid="dynamicSort" />
    </select>
    
    <select id="view" resultType="errLogBean" parameterType="errLogBean">
        SELECT SEQ     AS seq,
               URL     AS url,
               TITLE   AS title,
               SOLV_YN AS solvYn,
               TO_CHAR(SOLV_DT, 'YYYY-MM-DD HH24:MI:SS') AS solvDt,
               TO_CHAR(REG_DT, 'YYYY-MM-DD HH24:MI:SS') AS regDt,
               CONTENTS AS contents
          FROM CO_ERR_LOG
         WHERE SEQ = #{seq}
    </select>
    
    <insert id="insert" parameterType="errLogBean">
        INSERT INTO CO_ERR_LOG (
            SEQ,      URL,      TITLE,      CONTENTS
        )
        VALUES (
            #{seq},   #{url},   #{title},   #{contents}
        )
    </insert>
        
    <update id="update" parameterType="errLogBean">
        UPDATE CO_ERR_LOG 
           SET SOLV_YN = #{solvYn},
               SOLV_DT = SYSDATE
         WHERE SEQ = #{seq}
    </update>
    
    <delete id="delete" parameterType="errLogBean">
        DELETE 
          FROM CO_ERR_LOG
         WHERE 1 = 1
             <if test="@Ognl@isNotEmpty(seqs)">
                 AND SEQ IN 
                 <foreach collection="seqs" index="index" open="(" close=")" separator=", " item="entry">
                     #{entry}
                 </foreach>
             </if>
    </delete>

</mapper>
