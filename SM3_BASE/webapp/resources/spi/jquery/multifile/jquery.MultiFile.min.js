/*
 ### jQuery Multiple File Selection Plugin v2.0.3 - 2014-05-27 ###
 * Home: http://www.fyneworks.com/jquery/multifile/
 * Code: http://code.google.com/p/jquery-multifile-plugin/
 *
    * Licensed under http://en.wikipedia.org/wiki/MIT_License
 ###
*/
window.jQuery&&function(e){"use strict";function i(e){return(e/1024).toFixed(1)+"Kb"}e.fn.MultiFile=function(t){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var a=arguments;return this.each(function(){e.fn.MultiFile.apply(e(this),a)})}return e.fn.MultiFile[arguments[0]].apply(this,e.makeArray(arguments).slice(1)||[])}"number"==typeof t&&(t={max:t});var t=e.extend({},e.fn.MultiFile.options,t||{});e("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(e.fn.MultiFile.disableEmpty),e.fn.MultiFile.options.autoIntercept&&(e.fn.MultiFile.intercept(e.fn.MultiFile.options.autoIntercept),e.fn.MultiFile.options.autoIntercept=null),this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var a=window.MultiFile,l={e:this,E:e(this),clone:e(this).clone()},n=e.extend({},e.fn.MultiFile.options,t||{},(e.metadata?l.E.metadata():e.meta?l.E.data():null)||{},{});n.max>0||(n.max=l.E.attr("maxlength")),n.max>0||(n.max=(String(l.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.max=n.max>0?String(n.max).match(/[0-9]+/gi)[0]:-1),n.max=new Number(n.max),n.accept=n.accept||l.E.attr("accept")||"",n.accept||(n.accept=l.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",n.accept=new String(n.accept).replace(/^(accept|ext)\-/i,"")),n.maxsize=n.maxsize>0?n.maxsize:null||l.E.data("maxsize")||0,n.maxsize>0||(n.maxsize=(String(l.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.maxsize=n.maxsize>0?String(n.maxsize).match(/[0-9]+/gi)[0]:-1),n.maxfile=n.maxfile>0?n.maxfile:null||l.E.data("maxfile")||0,n.maxfile>0||(n.maxfile=(String(l.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],n.maxfile=n.maxfile>0?String(n.maxfile).match(/[0-9]+/gi)[0]:-1),n.maxfile>1&&(n.maxfile=1024*n.maxfile),n.maxsize>1&&(n.maxsize=1024*n.maxsize),n.max>1&&l.E.attr("multiple","multiple").prop("multiple",!0),e.extend(l,n||{}),l.STRING=e.extend({},e.fn.MultiFile.options.STRING,l.STRING),e.extend(l,{n:0,slaves:[],files:[],instanceKey:l.e.id||"MultiFile"+String(a),generateID:function(e){return l.instanceKey+(e>0?"_F"+String(e):"")},trigger:function(i,t,a,l){var n,r=a[i]||a["on"+i];return r?(l=l||a.files||(this.files?this.files[0]:null)||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],e.each(l,function(e,i){n=r(t,i.name,a,i)}),n):void 0}}),String(l.accept).length>1&&(l.accept=l.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),l.rxAccept=new RegExp("\\.("+(l.accept?l.accept:"")+")","gi")),l.wrapID=l.instanceKey+"_wrap",l.E.wrap('<div class="MultiFile-wrap" id="'+l.wrapID+'"></div>'),l.wrapper=e("#"+l.wrapID),l.e.name=l.e.name||"file"+a+"[]",l.list||(l.wrapper.append('<div class="MultiFile-list" id="'+l.wrapID+'_list"></div>'),l.list=e("#"+l.wrapID+"_list")),l.list=e(l.list),l.addSlave=function(t,n){l.n++,t.MultiFile=l,n>0&&(t.id=t.name=""),n>0&&(t.id=l.generateID(n)),t.name=String(l.namePattern.replace(/\$name/gi,e(l.clone).attr("name")).replace(/\$id/gi,e(l.clone).attr("id")).replace(/\$g/gi,a).replace(/\$i/gi,n));var r;l.max>0&&l.files.length>l.max&&(t.disabled=!0,r=!0),l.current=l.slaves[n]=t,t=e(t),t.val("").attr("value","")[0].value="",t.addClass("MultiFile-applied"),t.change(function(){e(this).blur();var a=this,r=l.files||[],s=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],c=[],u=0,o=l.total_size||0,m=[];e.each(s,function(e,i){c[c.length]=i}),l.trigger("FileSelect",this,l,c),e.each(s,function(e,t){var n=t.name,r=t.size,s=function(e){return e.replace("$ext",String(n.match(/[^\.]+$/i)||"")).replace("$file",n.match(/[^\/\\]+$/gi)).replace("$size",i(r)+" > "+i(l.maxfile))};l.accept&&n&&!n.match(l.rxAccept)&&(m[m.length]=s(l.STRING.denied),l.trigger("FileInvalid",this,l,[t]));var c=n.replace(/^C:\\fakepath\\/gi,"");for(var o in l.slaves)if(l.slaves[o]&&l.slaves[o]!=a){var p=(l.slaves[o].value||"").replace(/^C:\\fakepath\\/gi,"");(c==p||c==p.substr(p.length-c.length))&&(m[m.length]=s(l.STRING.duplicate),l.trigger("FileDuplicate",this,l,[t]))}l.maxfile>0&&r>0&&r>l.maxfile&&(m[m.length]=s(l.STRING.toobig),l.trigger("FileTooBig",this,l,[t]));var f=l.trigger("FileValidate",this,l,[t]);f&&""!=f&&(m[m.length]=s(f)),u+=t.size}),o+=u,c.size=u,c.total=o,c.total_length=c.length+r.length,console.log("* MultiFile.maxsize : "+l.maxsize+"\n * newfs.size : "+c.size+"\n * total_size : "+o),l.max>0&&r.length+s.length>l.max&&(m[m.length]=l.STRING.toomany.replace("$max",l.max),l.trigger("FileTooMany",this,l,c)),l.maxsize>0&&o>l.maxsize&&(m[m.length]=l.STRING.toomuch.replace("$size",i(o)+" > "+i(l.maxsize)),l.trigger("FileTooMuch",this,l,c));var p=e(l.clone).clone();return p.addClass("MultiFile"),m.length>0?(l.error(m.join("\n\n")),l.n--,l.addSlave(p[0],n),t.parent().prepend(p),t.remove(),!1):(l.total_size=o,s=r.concat(c),s.size=o,s.size_label=i(o),l.files=s,e(this).css({position:"absolute",top:"-3000px"}),t.after(p),l.addSlave(p[0],n+1),l.addToList(this,n,c),l.trigger("afterFileSelect",this,l,c),void 0)}),e(t).data("MultiFile",l),r&&e(t).attr("disabled","disabled").prop("disabled",!0)},l.addToList=function(t,a,n){l.trigger("FileAppend",t,l,n);var r=[];e.each(n,function(e,t){var a=String(t.name||"");r[r.length]=('<span class="MultiFile-title" title="'+l.STRING.selected+'">'+l.STRING.file+"</span>").replace(/\$(file|name)/gi,(a.match(/[^\/\\]+$/gi)||[a])[0]).replace(/\$(ext|extension|type)/gi,(a.match(/[^\.]+$/gi)||[""])[0]).replace(/\$(size)/gi,i(t.size||0))}),r=r.join(", ");var s=e('<div class="MultiFile-label"></div>'),c=e('<a class="MultiFile-remove" href="#'+l.wrapID+'">'+l.STRING.remove+"</a>").click(function(){l.trigger("FileRemove",t,l,s),l.n--,l.current.disabled=!1,l.slaves[a]=null,e(t).remove(),e(this).parent().remove(),e(l.current).css({position:"",top:""}),e(l.current).reset().val("").attr("value","")[0].value="";var i=[];l.total_size=0;for(var n in l.slaves){var r=l.slaves[n];if(null!=r&&void 0!=r){var s=(r.files&&r.files.length?r.files:null)||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}];e.each(s,function(e,t){void 0!=t.name&&(i[i.length]=t,l.total_size+=t.size)})}}return l.files=i,l.trigger("afterFileRemove",t,l,s),l.trigger("FileChange",t,l,l.files),!1});l.list.append(s.append(c," ",r)),l.trigger("afterFileAppend",t,l,n),l.trigger("FileChange",t,l,l.files)},l.MultiFile||l.addSlave(l.e,0),l.n++,l.E.data("MultiFile",l)})},e.extend(e.fn.MultiFile,{reset:function(){var i=e(this).data("MultiFile");return i&&i.list.find("a.MultiFile-remove").click(),e(this)},files:function(){var e=this.data("MultiFile");return e?e.files||[]:!console.log("MultiFile plugin not initialized")},size:function(){var e=this.data("MultiFile");return e?e.total_size||[]:!console.log("MultiFile plugin not initialized")},count:function(){var e=this.data("MultiFile");return e?e.files.length||[]:!console.log("MultiFile plugin not initialized")},disableEmpty:function(i){i=("string"==typeof i?i:"")||"mfD";var t=[];return e("input:file.MultiFile").each(function(){""==e(this).val()&&(t[t.length]=this)}),window.clearTimeout(e.fn.MultiFile.reEnableTimeout),e.fn.MultiFile.reEnableTimeout=window.setTimeout(e.fn.MultiFile.reEnableEmpty,500),e(t).each(function(){this.disabled=!0}).addClass(i)},reEnableEmpty:function(i){return i=("string"==typeof i?i:"")||"mfD",e("input:file."+i).removeClass(i).each(function(){this.disabled=!1})},intercepted:{},intercept:function(i,t,a){var l,n;if(a=a||[],a.constructor.toString().indexOf("Array")<0&&(a=[a]),"function"==typeof i)return e.fn.MultiFile.disableEmpty(),n=i.apply(t||window,a),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n;i.constructor.toString().indexOf("Array")<0&&(i=[i]);for(var r=0;r<i.length;r++)l=i[r]+"",l&&function(i){e.fn.MultiFile.intercepted[i]=e.fn[i]||function(){},e.fn[i]=function(){return e.fn.MultiFile.disableEmpty(),n=e.fn.MultiFile.intercepted[i].apply(this,arguments),setTimeout(function(){e.fn.MultiFile.reEnableEmpty()},1e3),n}}(l)}}),e.fn.MultiFile.options={accept:__MF_ACCEPT_EXTENSION,max:-1,maxfile:-1,maxsize:__MF_MAX_SIZE,namePattern:"$name",STRING:{remove:'<span class="t3-delete" title="첨부 취소">첨부 취소</span>',denied:"이 확장자 [$ext]는 첨부가 제한되었습니다.\n다시 선택해주세요.",file:"$file",selected:"선택한 파일: $file",duplicate:"이미 선택한 파일입니다.:\n[ $file ]",toomany:"최대 $max 개의 파일만 첨부할 수 있습니다.",toomuch:"업로드 가능한 최대 크기를 초과했습니다.\n($size)",toobig:"$file : 업로드 최대 크기 초과 (max $size)"},list:".selected-file",autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(e){alert(e)}},e.fn.reset=e.fn.reset||function(){return this.each(function(){try{this.reset()}catch(e){}})}}(jQuery);